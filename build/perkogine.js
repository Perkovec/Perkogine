var Perkogine={version:"1.0Î²"};Perkogine.Deg2Rad=Math.PI/180,Perkogine.Rag2Deg=180/Math.PI,Perkogine.Vector2D=function(t,e){this.x=t||0,this.y=e||0},Object.defineProperties(Perkogine.Vector2D,{left:{value:new Perkogine.Vector2D(-1,0),enumerable:!0},right:{value:new Perkogine.Vector2D(1,0),enumerable:!0},up:{value:new Perkogine.Vector2D(0,1),enumerable:!0},down:{value:new Perkogine.Vector2D(0,-1),enumerable:!0}}),Perkogine.Vector2D.prototype.set=function(t,e){return this.x=t,this.y=e,this},Perkogine.Vector2D.prototype.clone=function(){return new this.constructor(this.x,this.y)},Perkogine.Vector2D.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Perkogine.Vector2D.prototype.distanceTo=function(t){var e=this.x-t.x,o=this.y-t.y;return Math.sqrt(e*e+o*o)},Perkogine.Vector2D.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Perkogine.Vector2D.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},Perkogine.Vector2D.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},Perkogine.Vector2D.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},Perkogine.Vector2D.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Perkogine.Vector2D.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},Perkogine.Vector2D.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},Perkogine.Vector2D.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},Perkogine.Vector2D.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},Perkogine.Vector2D.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Perkogine.Vector2D.prototype.length=function(){return this.x*this.x+this.y*this.y},Perkogine.Vector2D.prototype.setLength=function(t){return this.multiplyScalar(t/this.length())},Perkogine.Scene=function(){this.objects=[]},Perkogine.Scene.prototype.Add=function(t){this.objects.push(t)},Perkogine.Renderer=function(t){t=t||{},this.parent=t.parent||document.body,this.width=t.width||500,this.height=t.height||500,this.clearColor=t.clearColor||"#FFFFFF";var e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.parent.appendChild(e);var o=e.getContext("2d");this.domElement=e,this._ctx=o,this.pointerLocked=!1},Perkogine.Renderer.prototype.clear=function(){this._ctx.fillStyle=this.clearColor,this._ctx.fillRect(0,0,this.width,this.height)},Perkogine.Renderer.prototype.enableLockPointer=function(t,e){function o(){document.pointerLockElement===i?(this.pointerLocked=!0,t()):(this.pointerLocked=!1,e())}var i=this.domElement;i.onclick=function(){i.requestPointerLock()},void 0!==document.onpointerlockchange&&document.addEventListener("pointerlockchange",o.bind(this),!1)},Perkogine.Renderer.prototype.Render=function(t){function e(t){s.beginPath(),s.arc(t.position.x,t.position.y,t.radius*t.scale,0,2*Math.PI,!1),s.fillStyle=null!==t.texture?s.createPattern(t.texture,"repeat"):t.color,s.fill(),s.strokeStyle=t.borderColor,s.strokeWidth=t.strokeWidth,s.stroke()}function o(t){s.beginPath(),s.save(),s.translate(t.position.x,t.position.y),s.rotate(Perkogine.Deg2Rad*t.rotation),s.rect(-t.width/2,-t.height/2,t.width,t.height),s.fillStyle=null!==t.texture?s.createPattern(t.texture,"repeat"):t.color,s.fill(),s.strokeStyle=t.borderColor,s.strokeWidth=t.strokeWidth,s.stroke(),s.restore()}function i(t){s.beginPath(),s.save(),s.translate(t.position.x,t.position.y),s.rotate(Perkogine.Deg2Rad*t.rotation),s.scale(t.width/t.height,1),s.arc(0,0,t.height/2,0,2*Math.PI,!1),s.fillStyle=null!==t.texture?s.createPattern(t.texture,"repeat"):t.color,s.fill(),s.strokeStyle=t.borderColor,s.strokeWidth=t.strokeWidth,s.stroke(),s.restore()}function r(t){var e=t.points;if(e.length){s.beginPath(),s.moveTo(t.position.x+e[0].x,t.position.y+e[0].y);for(var o=1;o<e.length;++o)s.lineTo(t.position.x+e[o].x,t.position.y+e[o].y);s.lineTo(t.position.x+e[0].x,t.position.y+e[0].y),s.fillStyle=null!==t.texture?s.createPattern(t.texture,"repeat"):t.color,s.fill(),s.strokeStyle=t.borderColor,s.strokeWidth=t.strokeWidth,s.stroke()}}function n(t){s.beginPath(),s.font=t.fontSize+"px "+t.font,s.fillStyle=null!==t.texture?s.createPattern(t.texture,"repeat"):t.color,s.strokeStyle=t.borderColor,s.strokeWidth=t.strokeWidth,s.fillText(t.text,t.position.x,t.position.y)}var s=this._ctx,h=t.objects.filter(function(t){return t.visible});h.sort(function(t,e){return t.layer<e.layer?-1:t.layer>e.layer?1:0});for(var c=0;c<h.length;++c){var l=h[c];l instanceof Perkogine.Circle?e(l):l instanceof Perkogine.Rectangle?o(l):l instanceof Perkogine.Ellipse?i(l):l instanceof Perkogine.PathShape?r(l):l instanceof Perkogine.Text&&n(l)}},Perkogine.Object=function(t){this.visible=t.visible||!0,this.position=t.position||new Perkogine.Vector2D,this.rotation=t.rotation||0,this.scale=t.scale||1,this.width=t.width||0,this.height=t.height||0,this.bounds=t.bounds||{}},Perkogine.Object.prototype.constructor=Perkogine.Object,Perkogine.Object.prototype.translate=function(t){return this.position.x+=Math.cos(Perkogine.Deg2Rad*this.rotation)*t,this.position.y+=Math.sin(Perkogine.Deg2Rad*this.rotation)*t,this},Perkogine.Object.prototype.rotate=function(t){return this.rotation+=t,this},Perkogine.Object.prototype.rotateAround=function(t,e){e=Perkogine.Deg2Rad*e;var o=this.position.clone();return this.position.x=Math.cos(e)*(o.x-t.x)-Math.sin(e)*(o.y-t.y)+t.x,this.position.y=Math.cos(e)*(o.y-t.y)+Math.sin(e)*(o.x-t.x)+t.y,this},Perkogine.Object.prototype.copy=function(t){return this.visible=t.visible,this.position.copy(t.position),this.rotation=t.rotation,this.scale=t.scale,this},Perkogine.Object.prototype.clone=function(){return(new this.constructor).copy(this)},Perkogine.PathShape=function(t){Perkogine.Object.call(this,arguments),this.points=t.points||[],this.color=t.color||"#FFFFFF",this.borderColor=t.borderColor||"#FFFFFF",this.borderWidth=t.borderWidth||0,this.texture=t.texture||null},Perkogine.PathShape.prototype=Object.create(Perkogine.Object.prototype),Perkogine.PathShape.prototype.constructor=Perkogine.PathShape,Perkogine.PathShape.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Circle=function(t){function e(){r.bounds={left:o.x-i,right:o.x+i,top:o.y-i,bottom:o.y+i}}Perkogine.Object.call(this,arguments),this.color=t.color||"#FFFFFF",this.borderColor=t.borderColor||"#FFFFFF",this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var o=this.position.clone(),i=t.radius||0,r=this;Object.defineProperty(this,"radius",{get:function(){return i},set:function(t){this.width=2*t,this.height=2*t,i=t,e()}}),Object.defineProperty(this.position,"x",{get:function(){return o.x},set:function(t){o.x=t,e()}}),Object.defineProperty(this.position,"y",{get:function(){return o.y},set:function(t){o.y=t,e()}})},Perkogine.Circle.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Circle.prototype.constructor=Perkogine.Circle,Perkogine.Circle.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Rectangle=function(t){function e(){n.bounds={left:r.x-o/2,right:r.x+o/2,top:r.y-i/2,bottom:r.y+i/2}}Perkogine.Object.call(this,arguments),this.color=t.color||"#FFFFFF",this.borderColor=t.borderColor||"#FFFFFF",this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var o=t.width||0,i=t.height||0,r=this.position.clone(),n=this;Object.defineProperty(this,"width",{get:function(){return o},set:function(t){o=t,e()}}),Object.defineProperty(this,"height",{get:function(){return i},set:function(t){i=t,e()}}),this.width=o,this.height=i,Object.defineProperty(this.position,"x",{get:function(){return r.x},set:function(t){r.x=t,e()}.bind(this)}),Object.defineProperty(this.position,"y",{get:function(){return r.y},set:function(t){r.y=t,e()}.bind(this)})},Perkogine.Rectangle.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Rectangle.prototype.constructor=Perkogine.Rectangle,Perkogine.Rectangle.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Ellipse=function(t){Perkogine.Object.call(this,arguments),this.width=t.width||0,this.height=t.height||0,this.color=t.color||"#FFFFFF",this.borderColor=t.borderColor||"#FFFFFF",this.borderWidth=t.borderWidth||0,this.texture=t.texture||null},Perkogine.Ellipse.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Ellipse.prototype.constructor=Perkogine.Ellipse,Perkogine.Ellipse.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Text=function(t){Perkogine.Object.call(this,arguments),this.color=t.color||"#FFFFFF",this.borderColor=t.borderColor||"#FFFFFF",this.borderWidth=t.borderWidth||0,this.texture=t.texture||null,this.font=t.font||"Arial",this.fontSize=t.fontSize||16,this.text=t.text||""},Perkogine.Text.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Text.prototype.constructor=Perkogine.Ellipse,Perkogine.Text.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.CountManager=function(t,e){this.count=t,this.callback=e,this.current=0},Perkogine.CountManager.prototype.tick=function(){this.current++,this.current>=this.count&&this.callback()},Perkogine.AssetsManager=function(){this.assets={}},Perkogine.AssetsManager.prototype.loadImages=function(t,e){if(t.length)for(var o=new Perkogine.CountManager(t.length,e),i=0;i<t.length;++i)(function(t,e){var i=this,r=new Image;r.onload=function(){i.assets[e.name]=r,o.tick()},r.src=e.source}).bind(this)(o,t[i])},Perkogine.Keyboard=function(t){function e(t){this.keys[t.keyCode||t.which]=!0,this.keys.shift=t.shiftKey,this.keys.ctrl=t.ctrlKey,this.keys.alt=t.altKey}function o(t){this.keys[t.keyCode||t.which]=!1,this.keys.shift=t.shiftKey,this.keys.ctrl=t.ctrlKey,this.keys.alt=t.altKey}this.keys={},t.addEventListener("keydown",e.bind(this),!1),t.addEventListener("keyup",o.bind(this),!1)},Perkogine.Keys={},Object.defineProperties(Perkogine.Keys,{Tab:{value:9},Esc:{value:27},Ins:{value:45},Del:{value:46},Space:{value:32},Caps_Lock:{value:20},Shift:{value:"shift"},Ctrl:{value:"ctrl"},Alt:{value:"alt"},UP:{value:38},DOWN:{value:40},LEFT:{value:37},RIGHT:{value:39},Num_0:{value:48},Num_1:{value:49},Num_2:{value:50},Num_3:{value:51},Num_4:{value:52},Num_5:{value:53},Num_6:{value:54},Num_7:{value:55},Num_8:{value:56},Num_9:{value:57},A:{value:65},B:{value:66},C:{value:67},D:{value:68},E:{value:69},F:{value:70},G:{value:71},H:{value:72},I:{value:73},J:{value:74},K:{value:75},L:{value:76},M:{value:77},N:{value:78},O:{value:79},P:{value:80},Q:{value:81},R:{value:82},S:{value:83},T:{value:84},U:{value:85},V:{value:86},W:{value:87},X:{value:88},Y:{value:89},Z:{value:90}});