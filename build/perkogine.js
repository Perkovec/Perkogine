var Perkogine={version:"1.0Î²"};Perkogine.Deg2Rad=Math.PI/180,Perkogine.Rag2Deg=180/Math.PI,Perkogine.Vector2D=function(t,e){this.x=t||0,this.y=e||0},Object.defineProperties(Perkogine.Vector2D,{left:{value:new Perkogine.Vector2D(-1,0),enumerable:!0},right:{value:new Perkogine.Vector2D(1,0),enumerable:!0},up:{value:new Perkogine.Vector2D(0,1),enumerable:!0},down:{value:new Perkogine.Vector2D(0,-1),enumerable:!0}}),Perkogine.Vector2D.prototype.set=function(t,e){return this.x=t,this.y=e,this},Perkogine.Vector2D.prototype.clone=function(){return new this.constructor(this.x,this.y)},Perkogine.Vector2D.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Perkogine.Vector2D.prototype.distanceTo=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},Perkogine.Vector2D.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Perkogine.Vector2D.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},Perkogine.Vector2D.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},Perkogine.Vector2D.prototype.multiplyScalar=function(t){return isFinite(t)?(this.x*=t,this.y*=t):this.set(0,0),this},Perkogine.Vector2D.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Perkogine.Vector2D.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},Perkogine.Vector2D.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},Perkogine.Vector2D.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},Perkogine.Vector2D.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},Perkogine.Vector2D.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Perkogine.Vector2D.prototype.length=function(){return this.x*this.x+this.y*this.y},Perkogine.Vector2D.prototype.setLength=function(t){return this.multiplyScalar(t/this.length())},Perkogine.Vector2D.prototype.clampLength=function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},Perkogine.Vector2D.prototype.clampXProp=function(t,e){var i=Math.max(t,Math.min(e,this.x))/this.x;return this.multiplyScalar(i),this},Perkogine.Vector2D.prototype.clampYProp=function(t,e){var i=Math.max(t,Math.min(e,this.y))/this.y;return this.multiplyScalar(i),this},Perkogine.Math={},Perkogine.Math.UUID=function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),o=0;return function(){for(var n=0;36>n;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(2>=o&&(o=33554432+16777216*Math.random()|0),t=15&o,o>>=4,i[n]=e[19===n?3&t|8:t]);return i.join("")}}(),Perkogine.Utils={},Perkogine.Utils.oneArray=function(t){for(var e=[],i=t.length,o=0;i>o;o++)t[o].children.length&&(e=e.concat(Perkogine.Utils.oneArray(t[o].children))),e.push(t[o]);return e},Perkogine.Color=function(t,e,i){return this.r=1,this.g=1,this.b=1,this.a=1,this._regexRGB=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/g,this._regexRGBA=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/g,this._regexShortHEX=/^#([0-9a-fA-F]{3})$/g,this._regexHEX=/^#([0-9a-fA-F]{6})$/g,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)},Perkogine.Color.prototype.set=function(t){return t instanceof Perkogine.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setFromStyle(t),this},Perkogine.Color.prototype.setRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},Perkogine.Color.prototype.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},Perkogine.Color.prototype.setFromStyle=function(t){var e=this._regexRGB.exec(t),i=this._regexRGBA.exec(t),o=this._regexShortHEX.exec(t),n=this._regexHEX.exec(t);if(null!==e)this.r=e[1],this.g=e[2],this.b=e[3],this.a=1;else if(null!==i)this.r=i[1],this.g=i[2],this.b=i[3],this.a=i[4];else if(null!==o){var r=o[1];this.r=17*parseInt(r.charAt(0),16)/255,this.g=17*parseInt(r.charAt(1),16),this.b=17*parseInt(r.charAt(2),16),this.a=1}else if(null!==n){var r=n[1];this.r=parseInt(r.substr(0,2),16)/255,this.g=parseInt(r.substr(2,2),16)/255,this.b=parseInt(r.substr(4,2),16)/255,this.a=1}return this},Perkogine.Color.prototype.getHEX=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},Perkogine.Color.prototype.getHEXString=function(){return("000000"+this.getHEX().toString(16)).slice(-6)},Perkogine.Scene=function(){this.objects=[],this.rotation=0,this.position=new Perkogine.Vector2D},Perkogine.Scene.prototype.Add=function(t){t.parent=this,t instanceof Perkogine.Line||t.localPosition.set(t.position.x,t.position.y),this.objects.push(t)},Perkogine.Scene.prototype.Remove=function(t){for(var e=0;e<this.objects.length;++e)if(this.objects[e].UUID==t.UUID){this.objects.splice(e,1);break}},Perkogine.Renderer=function(t){t=t||{},this.parent=t.parent||document.body,this.width=t.width||500,this.height=t.height||500,this.clearColor=t.clearColor||new Perkogine.Color;var e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.parent.appendChild(e);var i=e.getContext("2d");this.domElement=e,this._ctx=i,this.pointerLocked=!1},Perkogine.Renderer.prototype.clear=function(){this._ctx.fillStyle="#"+this.clearColor.getHEXString(),this._ctx.fillRect(0,0,this.width,this.height)},Perkogine.Renderer.prototype.enableLockPointer=function(t,e){function i(){document.pointerLockElement===o?(this.pointerLocked=!0,t()):(this.pointerLocked=!1,e())}var o=this.domElement;o.onclick=function(){o.requestPointerLock()},void 0!==document.onpointerlockchange&&document.addEventListener("pointerlockchange",i.bind(this),!1)},Perkogine.Renderer._objectsFilter=function(t){return t.visible||!(t.bounds.right<0||t.bounds.left>scope.width||t.bounds.bottom<0||t.bounds.top>scope.height)},Perkogine.Renderer._sortLayers=function(t,e){return t.layer<e.layer?-1:t.layer>e.layer?1:0},Perkogine.Renderer.DrawObject=function(t,e,i,o){if(o=o||!1,t.beginPath(),t.save(),!o){var n=e.parent.position,r=e.parent.rotation,s=Math.sqrt(e.localPosition.x*e.localPosition.x+e.localPosition.y*e.localPosition.y),h=Math.asin(0==s?0:e.localPosition.y/s)+r*Perkogine.Deg2Rad,c=n.x+Math.cos(h)*s,a=n.y+Math.sin(h)*s;t.translate(c,a),t.rotate(Perkogine.Deg2Rad*e.rotation)}i(),Perkogine.Renderer.fillAndStroke(t,e),t.restore()},Perkogine.Renderer.DrawCircle=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.arc(e.width*(e.pivot.x-.5),e.width*(e.pivot.y-.5),e.radius*e.scale,0,2*Math.PI,!1)})},Perkogine.Renderer.DrawRectangle=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.rect(-e.width*e.pivot.x,-e.height*e.pivot.y,e.width,e.height)})},Perkogine.Renderer.DrawEllipse=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.ellipse(e.width*(e.pivot.x-.5),e.height*(e.pivot.y-.5),e.width/2,e.height/2,0,0,2*Math.PI)})},Perkogine.Renderer.DrawPathShape=function(t,e){var i=e.points;i.length&&Perkogine.Renderer.DrawObject(t,e,function(){t.moveTo(i[0].x,i[0].y);for(var e=1;e<i.length;++e)t.lineTo(i[e].x,i[e].y);t.closePath()})},Perkogine.Renderer.DrawText=function(t,e){t.beginPath(),t.save();var i=e.parent.position,o=e.parent.rotation,n=Math.sqrt(e.localPosition.x*e.localPosition.x+e.localPosition.y*e.localPosition.y),r=(Math.asin(e.localPosition.y*(0==n?0:1/n))+o)*Perkogine.Deg2Rad,s=i.x+Math.cos(r)*n,h=i.y+Math.sin(r)*n;t.translate(s,h),t.rotate(Perkogine.Deg2Rad*(e.rotation+o)),t.font=e.fontSize+"px "+e.font,t.fillStyle=null!==e.texture?t.createPattern(e.texture,"repeat"):"#"+e.color.getHEXString(),t.strokeStyle="#"+e.borderColor.getHEXString(),t.strokeWidth=e.borderWidth,t.fillText(e.text,-e.width*e.pivot.x,e.height*e.pivot.y),t.restore()},Perkogine.Renderer.DrawLine=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.translate(e.bounds.left+e.width/2,e.bounds.top+e.height/2),t.rotate(Perkogine.Deg2Rad*e.rotation),t.moveTo(-e.width/2,-e.height/2+.5),t.lineTo(e.width/2,e.height/2+.5)},!0)},Perkogine.Renderer.DrawImage=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.drawImage(e.image,-e.width*e.pivot.x,-e.height*e.pivot.y,e.width,e.height)})},Perkogine.Renderer.DrawSprite=function(t,e){Perkogine.Renderer.DrawObject(t,e,function(){t.drawImage(e.frames[e._currentFrame],-e.width*e.pivot.x,-e.height*e.pivot.y,e.width,e.height)})},Perkogine.Renderer.fillAndStroke=function(t,e){t.fillStyle=null!==e.texture?t.createPattern(e.texture,"repeat"):"#"+e.color.getHEXString(),t.fill(),t.strokeStyle="#"+e.borderColor.getHEXString(),t.lineWidth=e.borderWidth,e.borderWidth>0&&t.stroke()},Perkogine.Renderer.prototype.Render=function(t){var e=this._ctx,i=Perkogine.Utils.oneArray(t.objects);i=i.filter(Perkogine.Renderer._objectsFilter),i.sort(Perkogine.Renderer._sortLayers);for(var o,n=i.length,r=0;n>r;++r)o=i[r],o instanceof Perkogine.Circle?Perkogine.Renderer.DrawCircle(e,o):o instanceof Perkogine.Rectangle?Perkogine.Renderer.DrawRectangle(e,o):o instanceof Perkogine.Ellipse?Perkogine.Renderer.DrawEllipse(e,o):o instanceof Perkogine.PathShape?Perkogine.Renderer.DrawPathShape(e,o):o instanceof Perkogine.Text?Perkogine.Renderer.DrawText(e,o):o instanceof Perkogine.Line?Perkogine.Renderer.DrawLine(e,o):o instanceof Perkogine.Image?Perkogine.Renderer.DrawImage(e,o):o instanceof Perkogine.Sprite&&Perkogine.Renderer.DrawSprite(e,o)},Perkogine.Object=function(t){this.visible=t.visible||!0,this.position=t.position||new Perkogine.Vector2D,this.localPosition=t.position||new Perkogine.Vector2D,this.rotation=t.rotation||0,this.localRotation=this.rotation,this.scale=t.scale||1,this.width=t.width||0,this.height=t.height||0,this.bounds=t.bounds||{},this.layer=void 0!==t.layer?t.layer:0,this.pivot=t.pivot||new Perkogine.Vector2D(.5,.5),this.children=[],this.parent=null,this.UUID=Perkogine.Math.UUID()},Perkogine.Object.prototype.constructor=Perkogine.Object,Perkogine.Object.prototype.translate=function(t){var e=Math.cos(Perkogine.Deg2Rad*this.rotation)*t,i=Math.sin(Perkogine.Deg2Rad*this.rotation)*t;return this.position.x+=e,this.position.y+=i,this.localPosition.x+=e,this.localPosition.y+=i,this},Perkogine.Object.prototype.rotate=function(t){return this.rotation+=t,this.localRotation+=t,this},Perkogine.Object.prototype.rotateAround=function(t,e){e=Perkogine.Deg2Rad*e;var i=this.position.clone();return this.position.x=Math.cos(e)*(i.x-t.x)-Math.sin(e)*(i.y-t.y)+t.x,this.position.y=Math.cos(e)*(i.y-t.y)+Math.sin(e)*(i.x-t.x)+t.y,this},Perkogine.Object.prototype.copy=function(t){return this.visible=t.visible,this.position=t.position.clone(),this.localPosition=t.localPosition.clone(),this.rotation=t.rotation,this.localRotation=t.localRotation,this.scale=t.scale,this.pivot=t.pivot,this},Perkogine.Object.prototype.Add=function(t){if(t.parent=this,!(t instanceof Perkogine.Line)){var e=t.position.clone().sub(this.position);t.localPosition.set(e.x,e.y)}this.children.push(t)},Perkogine.Object.prototype.clone=function(){return(new this.constructor).copy(this)},Perkogine.PathShape=function(t){function e(){for(var t=0;t<o.length;++t)Object.defineProperty(o[t],"x",{set:function(t){this.__x=t,i()},get:function(){return this.__x}}),Object.defineProperty(o[t],"y",{set:function(t){this.__y=t,i()},get:function(){return this.__y}})}function i(){var t=0,e=0;if(o.length)var i=o[0].x,r=o[0].x,h=o[0].y,c=o[0].y;for(var a=0;a<o.length;++a)o[a].x<i&&(i=o[a].x),o[a].x>r&&(r=o[a].x),o[a].y<h&&(h=o[a].y),o[a].y>c&&(c=o[a].y);t=r-i,e=c-h,s.bounds={left:n.x+i,right:n.x+r,top:n.y+h,bottom:n.y+c},s.width=t,s.height=e}Perkogine.Object.call(this,t),this.color=t.color||new Perkogine.Color,this.borderColor=t.borderColor||new Perkogine.Color,this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var o=t.points||[],n=this.position.clone(),r=this.localPosition.clone(),s=this;i(),Object.defineProperty(this,"points",{set:function(t){o=t,i()},get:function(){return o}}),Object.defineProperty(this.position,"x",{get:function(){return n.x},set:function(t){r.x+=t-n.x,n.x=t,i()}}),Object.defineProperty(this.position,"y",{get:function(){return n.y},set:function(t){r.y+=t-n.y,n.y=t,i()}}),Object.defineProperty(this.localPosition,"x",{get:function(){return r.x},set:function(t){n.x+=t-r.x,r.x=t,i()}}),Object.defineProperty(this.localPosition,"y",{get:function(){return r.y},set:function(t){n.y+=t-r.y,r.y=t,i()}}),Object.defineProperty(o,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var t=0,n=this.length,r=arguments.length;r>t;t++,n++)o[n]=arguments[t];return i(),e(),n}})},Perkogine.PathShape.prototype=Object.create(Perkogine.Object.prototype),Perkogine.PathShape.prototype.constructor=Perkogine.PathShape,Perkogine.PathShape.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Circle=function(t){function e(){s.bounds.top=o.y-n,s.bounds.bottom=o.y+n}function i(){s.bounds.left=o.x-n,s.bounds.right=o.x+n}Perkogine.Object.call(this,t),this.color=t.color||new Perkogine.Color,this.borderColor=t.borderColor||new Perkogine.Color,this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var o=this.position.clone(),n=t.radius||0,r=this.localPosition.clone(),s=this;Object.defineProperty(this,"radius",{get:function(){return n},set:function(t){this.width=this.height=t<<1,n=t,e(),i()}}),Object.defineProperties(this.position,{x:{get:function(){return o.x},set:function(t){r.x+=t-o.x,o.x=t,i()}},y:{get:function(){return o.y},set:function(t){r.y+=t-o.y,o.y=t,e()}}}),Object.defineProperties(this.localPosition,{x:{get:function(){return r.x},set:function(t){o.x+=t-r.x,r.x=t,i()}},y:{get:function(){return r.y},set:function(t){o.y+=t-r.y,r.y=t,e()}}})},Perkogine.Circle.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Circle.prototype.constructor=Perkogine.Circle,Perkogine.Circle.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Rectangle=function(t){function e(){s.bounds={left:n.x-i/2,right:n.x+i/2,top:n.y-o/2,bottom:n.y+o/2}}Perkogine.Object.call(this,t),this.color=t.color||new Perkogine.Color,this.borderColor=t.borderColor||new Perkogine.Color,this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var i=t.width||0,o=t.height||0,n=this.position.clone(),r=this.localPosition.clone(),s=this;Object.defineProperty(this,"width",{get:function(){return i},set:function(t){i=t,e()}}),Object.defineProperty(this,"height",{get:function(){return o},set:function(t){o=t,e()}}),this.width=i,this.height=o,Object.defineProperty(this.position,"x",{get:function(){return n.x},set:function(t){r.x+=t-n.x,n.x=t,e()}.bind(this)}),Object.defineProperty(this.position,"y",{get:function(){return n.y},set:function(t){r.y+=t-n.y,n.y=t,e()}.bind(this)}),Object.defineProperty(this.localPosition,"x",{get:function(){return r.x},set:function(t){n.x+=t-r.x,r.x=t,e()}.bind(this)}),Object.defineProperty(this.localPosition,"y",{get:function(){return r.y},set:function(t){n.y+=t-r.y,r.y=t,e()}.bind(this)})},Perkogine.Rectangle.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Rectangle.prototype.constructor=Perkogine.Rectangle,Perkogine.Rectangle.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Ellipse=function(t){function e(){s.bounds={left:n.x-i/2,right:n.x+i/2,top:n.y-o/2,bottom:n.y+o/2}}Perkogine.Object.call(this,t),this.color=t.color||new Perkogine.Color,this.borderColor=t.borderColor||new Perkogine.Color,this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var i=t.width||0,o=t.height||0,n=this.position.clone(),r=this.localPosition.clone(),s=this;Object.defineProperty(this,"width",{get:function(){return i},set:function(t){i=t,e()}}),Object.defineProperty(this,"height",{get:function(){return o},set:function(t){o=t,e()}}),this.width=i,this.height=o,Object.defineProperty(this.position,"x",{get:function(){return n.x},set:function(t){r.x+=t-n.x,n.x=t,e()}}),Object.defineProperty(this.position,"y",{get:function(){return n.y},set:function(t){r.y+=t-n.y,n.y=t,e()}}),e(),Object.defineProperty(this.localPosition,"x",{get:function(){return r.x},set:function(t){n.x+=t-r.x,r.x=t,e()}.bind(this)}),Object.defineProperty(this.localPosition,"y",{get:function(){return r.y},set:function(t){n.y+=t-r.y,r.y=t,e()}.bind(this)})},Perkogine.Ellipse.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Ellipse.prototype.constructor=Perkogine.Ellipse,Perkogine.Ellipse.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Text=function(t){function e(){var t=document.createElement("canvas").getContext("2d");t.font=n+"px "+r,i.width=t.measureText(o).width,i.height=n,i.bounds={left:s.x-i.width/2,right:s.x+i.width/2,top:s.y-i.height/2,bottom:s.y+i.height/2}}Perkogine.Object.call(this,t),this.color=t.color||new Perkogine.Color("#000"),this.borderColor=t.borderColor||new Perkogine.Color,this.borderWidth=t.borderWidth||0,this.texture=t.texture||null;var i=this,o="",n=16,r="Arial",s=this.position.clone(),h=this.localPosition.clone();Object.defineProperty(this,"text",{get:function(){return o},set:function(t){o=t,e()}}),Object.defineProperty(this,"fontSize",{get:function(){return n},set:function(t){n=t,e()}}),Object.defineProperty(this,"font",{get:function(){return r},set:function(t){r=t,e()}}),Object.defineProperty(this.position,"x",{get:function(){return s.x},set:function(t){h.x+=t-s.x,s.x=t,e()}}),Object.defineProperty(this.position,"y",{get:function(){return s.y},set:function(t){h.y+=t-s.Y,s.y=t,e()}}),Object.defineProperty(this.localPosition,"x",{get:function(){return h.x},set:function(t){s.x+=t-h.x,h.x=t,e()}.bind(this)}),Object.defineProperty(this.localPosition,"y",{get:function(){return h.y},set:function(t){s.y+=t-h.y,h.y=t,e()}.bind(this)}),r=t.font||"Arial",n=t.fontSize||16,o=t.text||"",e()},Perkogine.Text.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Text.prototype.constructor=Perkogine.Ellipse,Perkogine.Text.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Line=function(t){function e(){n.bounds={left:i.x,right:o.x,top:i.y,bottom:o.y},n.width=n.bounds.right-n.bounds.left,n.height=n.bounds.bottom-n.bounds.top}Perkogine.Object.call(this,t),this.borderColor=t.borderColor||new Perkogine.Color("#000"),this.color=new Perkogine.Color,this.borderWidth=t.borderWidth||1,this.texture=t.texture||null,this.start=t.start||new Perkogine.Vector2D,this.end=t.end||new Perkogine.Vector2D;var i=(this.position.clone(),this.start.clone()),o=this.end.clone(),n=this;Object.defineProperty(this.start,"x",{get:function(){return i.x},set:function(t){i.x=t,e()}}),Object.defineProperty(this.start,"y",{get:function(){return i.y},set:function(t){i.y=t,e()}}),Object.defineProperty(this,"start",{get:function(){return i},set:function(t){i=t,e()}}),Object.defineProperty(this.end,"x",{get:function(){return o.x},set:function(t){o.x=t,e()}}),Object.defineProperty(this.end,"y",{get:function(){return o.y},set:function(t){o.y=t,e()}}),Object.defineProperty(this,"end",{get:function(){return o},set:function(t){o=t,e()}}),Object.defineProperty(this.position,"x",{get:function(){return null},set:function(){}}),Object.defineProperty(this.position,"y",{get:function(){return null},set:function(){}}),Object.defineProperty(this,"position",{get:function(){return null},set:function(){}}),e()},Perkogine.Line.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Line.prototype.constructor=Perkogine.Line,Perkogine.Line.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Line.prototype.translate=function(t){var e=Math.cos(Perkogine.Deg2Rad*this.rotation)*t,i=Math.sin(Perkogine.Deg2Rad*this.rotation)*t;return this.start.x+=e,this.start.y+=i,this.end.x+=e,this.end.y+=i,this},Perkogine.Line.prototype.rotateAround=function(t,e){e=Perkogine.Deg2Rad*e;var i=this.start.clone(),o=this.end.clone();return this.start.x=Math.cos(e)*(i.x-t.x)-Math.sin(e)*(i.y-t.y)+t.x,this.start.y=Math.cos(e)*(i.y-t.y)+Math.sin(e)*(i.x-t.x)+t.y,this.end.x=Math.cos(e)*(o.x-t.x)-Math.sin(e)*(o.y-t.y)+t.x,this.end.y=Math.cos(e)*(o.y-t.y)+Math.sin(e)*(o.x-t.x)+t.y,this},Perkogine.Image=function(t){function e(){s.bounds={left:i.x-s.width/2,right:i.x+s.width/2,top:i.y-s.height/2,bottom:i.y+s.height/2}}Perkogine.Object.call(this,t),this.image=t.image||new Image,this.texture=null,this.color=new Perkogine.Color;var i=this.position.clone(),o=this.localPosition.clone(),n=this.image.width,r=this.image.height,s=this;Object.defineProperty(this,"width",{get:function(){return n},set:function(t){n=t,e()}}),Object.defineProperty(this,"height",{get:function(){return r},set:function(t){r=t,e()}}),Object.defineProperty(this.position,"x",{get:function(){return i.x},set:function(t){o.x+=t-i.x,i.x=t,e()}}),Object.defineProperty(this.position,"y",{get:function(){return i.y},set:function(t){o.y+=t-i.y,i.y=t,e()}}),Object.defineProperty(this.localPosition,"x",{get:function(){return o.x},set:function(t){i.x+=t-o.x,o.x=t,e()}}),Object.defineProperty(this.localPosition,"y",{get:function(){return o.y},set:function(t){i.y+=t-o.y,o.y=t,e()}})},Perkogine.Image.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Image.prototype.constructor=Perkogine.Image,Perkogine.Image.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Sprite=function(t){function e(t,e){var i=document.createElement("canvas"),o=i.getContext("2d");i.width=t.width,i.height=t.height,o.drawImage(t,0,0);var n=[],r=document.createElement("canvas");r.width=e.width,r.height=e.height;for(var s=r.getContext("2d"),h=0;h<t.height/e.height;++h)for(var c=0;c<t.width/e.width;++c){s.clearRect(0,0,e.width,e.height),s.putImageData(o.getImageData(e.width*c,e.height*h,e.width,e.height),0,0);var a=new Image;a.src=r.toDataURL(),n.push(a)}return n}function i(){h.bounds={left:o.x-h.width/2,right:o.x+h.width/2,top:o.y-h.height/2,bottom:o.y+h.height/2}}Perkogine.Object.call(this,t),this._image=t.image||new Image,this._sheetData=t.sheetData||{},this._sequenceData=t.sequenceData||{},this.texture=null,this.color=new Perkogine.Color;var o=this.position.clone(),n=this.localPosition.clone(),r=this._image.width,s=this._image.height;this.frames=e(this._image,this._sheetData),this._currentFrame=this.frames.length>0?1:null;var h=this;Object.defineProperty(this,"width",{get:function(){return r},set:function(t){r=t,i()}}),Object.defineProperty(this,"height",{get:function(){return s},set:function(t){s=t,i()}}),Object.defineProperty(this.position,"x",{get:function(){return o.x},set:function(t){n.x+=t-o.x,o.x=t,i()}}),Object.defineProperty(this.position,"y",{get:function(){return o.y},set:function(t){n.y+=t-o.y,o.y=t,i()}}),Object.defineProperty(this.localPosition,"x",{get:function(){return n.x},set:function(t){o.x+=t-n.x,n.x=t,i()}}),Object.defineProperty(this.localPosition,"y",{get:function(){return n.y},set:function(t){o.y+=t-n.y,n.y=t,i()}})},Perkogine.Sprite.prototype=Object.create(Perkogine.Object.prototype),Perkogine.Sprite.prototype.constructor=Perkogine.Sprite,Perkogine.Sprite.prototype.clone=function(){return new this.constructor(this).copy(this)},Perkogine.Sprite.prototype.run=function(t){void 0!==this._interval&&clearInterval(this._interval);var e=this,i=this._sequenceData[t].time/this._sequenceData[t].count;this._currentFrame=this._sequenceData[t].start-1,this._interval=setInterval(function(t,i){e._currentFrame++,e._currentFrame>=i&&(e._currentFrame=t-1)},i,this._sequenceData[t].start,this._sequenceData[t].count+this._sequenceData[t].start-1)},Perkogine.CountManager=function(t,e){this.count=t,this.callback=e,this.current=0},Perkogine.CountManager.prototype.tick=function(){this.current++,this.current>=this.count&&this.callback()},Perkogine.AssetsManager=function(){this.assets={}},Perkogine.AssetsManager.prototype.loadImages=function(t,e){function i(t,e){var i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var o=new FileReader;o.onloadend=function(){e(o.result,t)},o.readAsDataURL(i.response)},i.open("GET",t.source),i.send()}if(t.length)for(var o=this,n=new Perkogine.CountManager(t.length,e),r=0;r<t.length;++r)i(t[r],function(t,e){var i=new Image;i.onload=function(){o.assets[e.name]=i,n.tick()},i.crossOrigin="Anonymous",i.src=e.source})},Perkogine.Keyboard=function(t){function e(t){this.keys[t.keyCode||t.which]=!0,this.keys.shift=t.shiftKey,this.keys.ctrl=t.ctrlKey,this.keys.alt=t.altKey}function i(t){this.keys[t.keyCode||t.which]=!1,this.keys.shift=t.shiftKey,this.keys.ctrl=t.ctrlKey,this.keys.alt=t.altKey}this.keys={},t.addEventListener("keydown",e.bind(this),!1),t.addEventListener("keyup",i.bind(this),!1)},Perkogine.Keys={},Object.defineProperties(Perkogine.Keys,{Tab:{value:9},Esc:{value:27},Ins:{value:45},Del:{value:46},Space:{value:32},Caps_Lock:{value:20},Shift:{value:"shift"},Ctrl:{value:"ctrl"},Alt:{value:"alt"},UP:{value:38},DOWN:{value:40},LEFT:{value:37},RIGHT:{value:39},Num_0:{value:48},Num_1:{value:49},Num_2:{value:50},Num_3:{value:51},Num_4:{value:52},Num_5:{value:53},Num_6:{value:54},Num_7:{value:55},Num_8:{value:56},Num_9:{value:57},A:{value:65},B:{value:66},C:{value:67},D:{value:68},E:{value:69},F:{value:70},G:{value:71},H:{value:72},I:{value:73},J:{value:74},K:{value:75},L:{value:76},M:{value:77},N:{value:78},O:{value:79},P:{value:80},Q:{value:81},R:{value:82},S:{value:83},T:{value:84},U:{value:85},V:{value:86},W:{value:87},X:{value:88},Y:{value:89},Z:{value:90}});